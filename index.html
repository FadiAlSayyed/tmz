<html> 
<head>  

 <script type="text/javascript">
     function successCallback(position) {
         
         coords = position.coords;
        // document.getElementById("lat").value = position.coords.latitude;
         //document.getElementById("long").value = position.coords.longitude;
       //  alert("You have been located. Latitude :" + position.coords.latitude + ", longitude : " + position.coords.longitude);
         
         var url = getParameterByName('callback');

         if (url != null) {
             //alert(url)
             if (url.includes("?"))
             {
                 url += "&lat=" + position.coords.latitude + "&long=" + position.coords.longitude;
             }
             else
             {
                 url += "?lat=" + position.coords.latitude + "&long=" + position.coords.longitude;
             }
             window.location.href = url;
         }
         else
         {
            document.getElementById("map").innerText="no callback url"; 
         }
     };
    function RedirectToErrorUrl(errorMessage)
    {
        var url = getParameterByName('callback');

         if (url != null) {
             //alert(url)
             if (url.includes("?"))
             {
                 url += "&locerror=" + errorMessage;
             }
             else
             {
                 url += "?locerror=" + errorMessage;
             }
             window.location.href = url;
         }
         else
         {
            document.getElementById("map").innerText="no callback url"; 
         }
    }
     function getParameterByName(name) {
         var url = window.location.href;
         name = name.replace(/[\[\]]/g, '\\$&');
         var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
             results = regex.exec(url);
         if (!results) return null;
         if (!results[2]) return '';
         return decodeURIComponent(results[2].replace(/\+/g, ' '));
     }

     function errorCallback(error) {
        // debugger;
        
         //alert("It didn't work");
         switch (error.code) {
             case error.PERMISSION_DENIED:
                 document.getElementById("map").innerText="Permission denied"; 
                 RedirectToErrorUrl("Permission denied");
                 //alert("Permission denied");
                 break;
             case error.POSITION_UNAVAILABLE:
                 //alert("Position unavailable");
                 document.getElementById("map").innerText="Position unavailable";
                 RedirectToErrorUrl("Position unavailable");
                 break;
             case error.TIMEOUT:
                 //alert("Timeout");
                 document.getElementById("map").innerText="Timeout";
                 RedirectToErrorUrl("Timeout");
                 break;
             case error.UNKNOW_ERROR:
                 //alert("Unknown error");
                 document.getElementById("map").innerText="Unknown error";
                 RedirectToErrorUrl("Unknown error");
                 break;
         }

     }
     function ini() {
        // alert("Trying to locate you");
        // debugger;


         if (navigator.geolocation) {
           //  alert("Geolocation is supported");

             iniGeoLocation(successCallback, errorCallback);


         }
         else {
             result.error = { code: -1 };
             document.getElementById("map").innerText="Geolocation is not supported";
             RedirectToErrorUrl("Geolocation is not supported");
             //alert("La géolocalisation n'est pas supportée par le navigateur");
         }



       
     }


function iniGeoLocation(successCallback, errorCallback) {
    //alert("aaa");
 
    navigator.geolocation.getCurrentPosition(successCallback, errorCallback,
         {
             enableHighAccuracy: true,
             timeout: 1000, // 10s
             maximumAge: 0
         }
       );
    debugger;
     
    //if (navigator.geolocation) {
    //    alert("Geolocation is supported");
       
          


    //}
    //else {
    //    result.error = { code: -1 };
    //    alert("La géolocalisation n'est pas supportée par le navigateur");
    //}
    
}

    
    






</script>

    <style>
    
#map {
  height: 100%;
}

/* 
 * Optional: Makes the sample page fill the window. 
 */
html,
body {
  height: 100%;
  margin: 0;
  padding: 0;
}

    </style>
    
</head> 

<body  onload="ini();"> 
    <div>
        
    </div>
  <div id="map">Loading...</div> 
</body> 
</html>